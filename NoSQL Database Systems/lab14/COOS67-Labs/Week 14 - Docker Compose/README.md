# Docker Compose Lab #13

# Section 0: Introduction

## Docker Compose ‡∏Ñ‡∏∑‡∏≠‡∏≠‡∏∞‡πÑ‡∏£?
<p align="center">
<img src="./image/docker-compose.png" width="480px" alt="What is docker compose?" />
</p>

**Docker Compose** ‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠‡∏ó‡∏µ‡πà‡∏ä‡πà‡∏ß‡∏¢‡πÉ‡∏´‡πâ‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÅ‡∏≠‡∏õ‡∏û‡∏•‡∏¥‡πÄ‡∏Ñ‡∏ä‡∏±‡∏ô‡πÅ‡∏ö‡∏ö‡∏°‡∏±‡∏•‡∏ï‡∏¥‡∏Ñ‡∏≠‡∏ô‡πÄ‡∏ó‡∏ô‡πÄ‡∏ô‡∏≠‡∏£‡πå‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏á‡πà‡∏≤‡∏¢‡πÅ‡∏•‡∏∞‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡∏†‡∏≤‡∏û‡∏°‡∏≤‡∏Å‡∏Ç‡∏∂‡πâ‡∏ô  ‡πÅ‡∏ó‡∏ô‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏ä‡πâ‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á `docker run` ‡∏´‡∏•‡∏≤‡∏¢‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏Ñ‡∏≠‡∏ô‡πÄ‡∏ó‡∏ô‡πÄ‡∏ô‡∏≠‡∏£‡πå  Docker Compose ‡∏ä‡πà‡∏ß‡∏¢‡πÉ‡∏´‡πâ‡πÄ‡∏£‡∏≤‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Ñ‡πà‡∏≤‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£ (service) ‡∏ï‡πà‡∏≤‡∏á‡πÜ ‡∏ó‡∏µ‡πà‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö‡∏Å‡∏±‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡πÅ‡∏≠‡∏õ‡∏û‡∏•‡∏¥‡πÄ‡∏Ñ‡∏ä‡∏±‡∏ô‡∏Ç‡∏≠‡∏á‡πÄ‡∏£‡∏≤‡πÑ‡∏î‡πâ‡πÉ‡∏ô‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏ß‡πà‡∏≤ `docker-compose.yaml`  ‡∏à‡∏≤‡∏Å‡∏ô‡∏±‡πâ‡∏ô‡πÄ‡∏£‡∏≤‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÉ‡∏ä‡πâ‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á `docker compose up` ‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡πÅ‡∏•‡∏∞‡∏£‡∏±‡∏ô‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏≠‡∏ô‡πÄ‡∏ó‡∏ô‡πÄ‡∏ô‡∏≠‡∏£‡πå‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÑ‡∏ß‡πâ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Å‡∏±‡∏ô‡πÑ‡∏î‡πâ

**‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏á‡πà‡∏≤‡∏¢ ‡πÜ:** ‡∏ñ‡πâ‡∏≤ Docker ‡∏Ñ‡∏∑‡∏≠‡πÄ‡∏ä‡∏ü‡∏ó‡∏µ‡πà‡∏ó‡∏≥‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏à‡∏≤‡∏ô, Docker Compose ‡∏Å‡πá‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡∏ú‡∏π‡πâ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ñ‡∏£‡∏±‡∏ß‡∏ó‡∏µ‡πà‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡πâ‡πÄ‡∏ä‡∏ü‡∏´‡∏•‡∏≤‡∏¢‡∏Ñ‡∏ô‡∏ó‡∏≥‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏´‡∏•‡∏≤‡∏¢‡πÜ ‡∏≠‡∏¢‡πà‡∏≤‡∏á (‡πÄ‡∏ä‡πà‡∏ô ‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏ô‡πâ‡∏≥‡∏¢‡πà‡∏≠‡∏¢, ‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏à‡∏≤‡∏ô‡∏´‡∏•‡∏±‡∏Å, ‡∏Ç‡∏≠‡∏á‡∏´‡∏ß‡∏≤‡∏ô) ‡πÅ‡∏•‡∏∞‡πÄ‡∏™‡∏¥‡∏£‡πå‡∏ü‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Å‡∏±‡∏ô‡πÑ‡∏î‡πâ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏•‡∏á‡∏ï‡∏±‡∏ß

**Docker Compose V2:** ‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô Docker Compose ‡πÑ‡∏î‡πâ‡∏£‡∏ß‡∏°‡πÄ‡∏Ç‡πâ‡∏≤‡πÑ‡∏õ‡πÄ‡∏õ‡πá‡∏ô‡∏™‡πà‡∏ß‡∏ô‡∏´‡∏ô‡∏∂‡πà‡∏á‡∏Ç‡∏≠‡∏á Docker CLI ‡πÅ‡∏•‡πâ‡∏ß (V2) ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡πÄ‡∏£‡∏≤‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏ú‡πà‡∏≤‡∏ô‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á `docker compose` ‡πÅ‡∏ó‡∏ô‡∏ó‡∏µ‡πà `docker-compose` (V1) ‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢  ‡∏ã‡∏∂‡πà‡∏á V2 ‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡∏†‡∏≤‡∏û‡∏ó‡∏µ‡πà‡∏î‡∏µ‡∏Å‡∏ß‡πà‡∏≤‡πÅ‡∏•‡∏∞‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå‡πÉ‡∏´‡∏°‡πà‡πÜ ‡∏°‡∏≤‡∏Å‡∏Ç‡∏∂‡πâ‡∏ô

## YAML ‡∏Ñ‡∏∑‡∏≠‡∏≠‡∏∞‡πÑ‡∏£?

**YAML** (‡∏¢‡πà‡∏≠‡∏°‡∏≤‡∏à‡∏≤‡∏Å "YAML Ain‚Äôt Markup Language") ‡πÄ‡∏õ‡πá‡∏ô‡∏†‡∏≤‡∏©‡∏≤‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡πÄ‡∏ô‡πâ‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏á‡πà‡∏≤‡∏¢ ‡∏≠‡πà‡∏≤‡∏ô‡∏á‡πà‡∏≤‡∏¢ ‡πÅ‡∏•‡∏∞‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡∏á‡πà‡∏≤‡∏¢‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏°‡∏ô‡∏∏‡∏©‡∏¢‡πå  YAML ‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡πÑ‡∏ü‡∏•‡πå‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Ñ‡πà‡∏≤‡∏ï‡πà‡∏≤‡∏á‡πÜ ‡πÄ‡∏ô‡∏∑‡πà‡∏≠‡∏á‡∏à‡∏≤‡∏Å‡∏°‡∏µ‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ó‡∏µ‡πà‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô‡πÇ‡∏î‡∏¢‡πÉ‡∏ä‡πâ‡∏Å‡∏≤‡∏£‡πÄ‡∏¢‡∏∑‡πâ‡∏≠‡∏á (indentation) ‡πÅ‡∏ó‡∏ô‡∏™‡∏±‡∏ç‡∏•‡∏±‡∏Å‡∏©‡∏ì‡πå‡∏ó‡∏µ‡πà‡∏ã‡∏±‡∏ö‡∏ã‡πâ‡∏≠‡∏ô‡∏≠‡∏¢‡πà‡∏≤‡∏á JSON ‡∏´‡∏£‡∏∑‡∏≠ XML

‡πÑ‡∏ü‡∏•‡πå `docker-compose.yaml` ‡πÄ‡∏õ‡πá‡∏ô‡πÑ‡∏ü‡∏•‡πå YAML ‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Ñ‡πà‡∏≤‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏Ç‡∏≠‡∏á Docker Compose  ‡πÇ‡∏î‡∏¢‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ‡∏à‡∏∞‡∏°‡∏µ‡∏™‡πà‡∏ß‡∏ô‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö‡∏´‡∏•‡∏±‡∏Å  ‡∏î‡∏±‡∏á‡∏ô‡∏µ‡πâ:

### `version` (‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏ä‡πâ‡πÅ‡∏•‡πâ‡∏ß)

```yaml
version: '3.8' # ‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏ä‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏π‡∏á‡∏Å‡∏ß‡πà‡∏≤ ‡πÄ‡∏ä‡πà‡∏ô '3.9', '3.10', '3.11', '3.12'
```


*   `version` ‡∏ó‡∏µ‡πà‡πÄ‡∏Ñ‡∏¢‡∏≠‡∏¢‡∏π‡πà‡∏ö‡∏ô‡∏™‡∏∏‡∏î‡∏Ç‡∏≠‡∏á‡πÑ‡∏ü‡∏•‡πå Compose ‡πÄ‡∏≠‡∏≤‡πÑ‡∏ß‡πâ‡∏ö‡∏≠‡∏Å‡∏£‡∏∏‡πà‡∏ô‡∏Ç‡∏≠‡∏á‡πÑ‡∏ü‡∏•‡πå ‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ**‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏™‡πà‡πÅ‡∏•‡πâ‡∏ß**
*   Compose ‡∏à‡∏∞‡πÉ‡∏ä‡πâ‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡πÑ‡∏ü‡∏•‡πå (schema) ‡∏ó‡∏µ‡πà‡πÉ‡∏´‡∏°‡πà‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î‡πÄ‡∏™‡∏°‡∏≠‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÑ‡∏ü‡∏•‡πå Compose
*   ‡∏ñ‡πâ‡∏≤‡πÑ‡∏ü‡∏•‡πå Compose ‡∏°‡∏µ‡∏≠‡∏∞‡πÑ‡∏£‡∏ó‡∏µ‡πà Compose ‡πÑ‡∏°‡πà‡∏£‡∏π‡πâ‡∏à‡∏±‡∏Å (‡πÄ‡∏û‡∏£‡∏≤‡∏∞‡πÄ‡∏õ‡πá‡∏ô‡∏Ç‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà) Compose ‡∏à‡∏∞‡πÅ‡∏Ñ‡πà**‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô** ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡πÄ‡∏Å‡∏¥‡∏î‡∏õ‡∏±‡∏ç‡∏´‡∏≤

Source: [https://docs.docker.com/reference/compose-file/version-and-name/#version-top-level-element-obsolete](https://docs.docker.com/reference/compose-file/version-and-name/#version-top-level-element-obsolete)

#### ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏:

- **‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏ä‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°:**  ‡πÇ‡∏î‡∏¢‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ‡∏Ñ‡∏ß‡∏£‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏ä‡∏±‡∏ô‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡∏ó‡∏µ‡πà Docker Engine ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö  ‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏ä‡∏±‡∏ô '3.8' ‡∏Ç‡∏∂‡πâ‡∏ô‡πÑ‡∏õ‡∏ñ‡∏∑‡∏≠‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏ä‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏Ñ‡πà‡∏≠‡∏ô‡∏Ç‡πâ‡∏≤‡∏á‡πÉ‡∏´‡∏°‡πà‡πÅ‡∏•‡∏∞‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ‡∏´‡∏•‡∏≤‡∏Å‡∏´‡∏•‡∏≤‡∏¢  ‡∏Ñ‡∏∏‡∏ì‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£ Docker Compose ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏ä‡∏±‡∏ô‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡πÅ‡∏•‡∏∞‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå‡∏ó‡∏µ‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡πÑ‡∏î‡πâ‡πÄ‡∏™‡∏°‡∏≠
- **‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏ä‡∏±‡∏ô `version` ‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏ä‡∏±‡∏ô Docker Compose:**  `version` ‡πÉ‡∏ô `docker-compose.yaml` ‡∏´‡∏°‡∏≤‡∏¢‡∏ñ‡∏∂‡∏á‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏ä‡∏±‡∏ô‡∏Ç‡∏≠‡∏á *‡πÑ‡∏ü‡∏•‡πå‡∏ü‡∏≠‡∏£‡πå‡πÅ‡∏°‡∏ï* ‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏ä‡∏±‡∏ô‡∏Ç‡∏≠‡∏á Docker Compose ‡πÄ‡∏≠‡∏á  ‡∏î‡∏±‡∏á‡∏ô‡∏±‡πâ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏ä‡∏±‡∏ô‡πÉ‡∏ô‡πÑ‡∏ü‡∏•‡πå‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏´‡∏°‡∏≤‡∏¢‡∏ñ‡∏∂‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏ä‡∏±‡∏ô Docker Compose ‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡πÉ‡∏ä‡πâ

### ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á `services` (‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ)

```yaml
services:
  web:
    image: nginx:latest # ‡∏£‡∏∞‡∏ö‡∏∏ image ‡∏û‡∏£‡πâ‡∏≠‡∏° tag :latest ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏ä‡πâ‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏ä‡∏±‡∏ô‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î
    ports:
      - "80:80"
    volumes:
      - ./html:/usr/share/nginx/html # Mount volume ‡πÄ‡∏û‡∏∑‡πà‡∏≠ map ‡πÇ‡∏ü‡∏•‡πÄ‡∏î‡∏≠‡∏£‡πå ./html ‡πÉ‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á host ‡πÑ‡∏õ‡∏¢‡∏±‡∏á /usr/share/nginx/html ‡πÉ‡∏ô container
    networks:
      - app-network # ‡∏Å‡∏≥‡∏´‡∏ô‡∏î network ‡πÉ‡∏´‡πâ service ‡∏ô‡∏µ‡πâ

  db:
    image: mysql:8.0 # ‡∏£‡∏∞‡∏ö‡∏∏ image ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏ä‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£
    environment:
      MYSQL_ROOT_PASSWORD: secret
      MYSQL_DATABASE: myapp_db
    volumes:
      - db-data:/var/lib/mysql # Named volume ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• database
    networks:
      - app-network

volumes: # ‡∏Å‡∏≥‡∏´‡∏ô‡∏î named volume
  db-data:

networks: # ‡∏Å‡∏≥‡∏´‡∏ô‡∏î network
  app-network:
    driver: bridge # ‡∏Å‡∏≥‡∏´‡∏ô‡∏î driver ‡∏Ç‡∏≠‡∏á network (bridge ‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡πà‡∏≤ default)
```

#### ‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢:

- `services` ‡πÄ‡∏õ‡πá‡∏ô‡∏™‡πà‡∏ß‡∏ô‡∏´‡∏•‡∏±‡∏Å‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏Ñ‡∏≠‡∏ô‡πÄ‡∏ó‡∏ô‡πÄ‡∏ô‡∏≠‡∏£‡πå (‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏ß‡πà‡∏≤ "service") ‡∏ó‡∏µ‡πà Docker Compose ‡∏à‡∏∞‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÅ‡∏•‡∏∞‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£  ‡πÅ‡∏ï‡πà‡∏•‡∏∞ service ‡∏à‡∏∞‡πÅ‡∏ó‡∏ô‡∏´‡∏ô‡∏∂‡πà‡∏á‡∏Ñ‡∏≠‡∏ô‡πÄ‡∏ó‡∏ô‡πÄ‡∏ô‡∏≠‡∏£‡πå‡∏ó‡∏µ‡πà‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÉ‡∏ô‡πÅ‡∏≠‡∏õ‡∏û‡∏•‡∏¥‡πÄ‡∏Ñ‡∏ä‡∏±‡∏ô‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì

#### ‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏¢‡πà‡∏≠‡∏¢ (‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á):

- `web`:  ‡∏ä‡∏∑‡πà‡∏≠ service ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏ß‡πá‡∏ö‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå
    - `image`: ‡∏£‡∏∞‡∏ö‡∏∏ Docker image ‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ñ‡∏≠‡∏ô‡πÄ‡∏ó‡∏ô‡πÄ‡∏ô‡∏≠‡∏£‡πå (‡πÄ‡∏ä‡πà‡∏ô `nginx:latest` ‡∏Ñ‡∏∑‡∏≠ image Nginx ‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏ä‡∏±‡∏ô‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡∏à‡∏≤‡∏Å Docker Hub)  **‡∏Ñ‡∏ß‡∏£‡∏£‡∏∞‡∏ö‡∏∏ tag ‡∏Ç‡∏≠‡∏á image ‡πÄ‡∏™‡∏°‡∏≠** ‡πÅ‡∏ó‡∏ô‡∏ó‡∏µ‡πà‡∏à‡∏∞‡πÉ‡∏ä‡πâ `:latest` ‡πÉ‡∏ô production ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏ä‡∏±‡∏ô‡∏Ç‡∏≠‡∏á image ‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ
    - `ports`:  ‡∏Å‡∏≥‡∏´‡∏ô‡∏î port mapping ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ port ‡∏Ç‡∏≠‡∏á‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á host ‡∏Å‡∏±‡∏ö port ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏≠‡∏ô‡πÄ‡∏ó‡∏ô‡πÄ‡∏ô‡∏≠‡∏£‡πå (‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö "hostPort:containerPort")  `"80:80"` ‡∏´‡∏°‡∏≤‡∏¢‡∏ñ‡∏∂‡∏á map port 80 ‡∏Ç‡∏≠‡∏á host ‡πÑ‡∏õ‡∏¢‡∏±‡∏á port 80 ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏≠‡∏ô‡πÄ‡∏ó‡∏ô‡πÄ‡∏ô‡∏≠‡∏£‡πå
    - `volumes`:  ‡∏Å‡∏≥‡∏´‡∏ô‡∏î volume ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÅ‡∏ä‡∏£‡πå‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á host ‡πÅ‡∏•‡∏∞‡∏Ñ‡∏≠‡∏ô‡πÄ‡∏ó‡∏ô‡πÄ‡∏ô‡∏≠‡∏£‡πå ‡∏´‡∏£‡∏∑‡∏≠‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏Ñ‡∏≠‡∏ô‡πÄ‡∏ó‡∏ô‡πÄ‡∏ô‡∏≠‡∏£‡πå‡∏î‡πâ‡∏ß‡∏¢‡∏Å‡∏±‡∏ô
        - **Bind mount:**  `./html:/usr/share/nginx/html` (‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö `hostPath:containerPath`) ‡∏Ñ‡∏∑‡∏≠‡∏Å‡∏≤‡∏£ mount ‡πÇ‡∏ü‡∏•‡πÄ‡∏î‡∏≠‡∏£‡πå `./html` ‡πÉ‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á host ‡πÑ‡∏õ‡∏¢‡∏±‡∏á `/usr/share/nginx/html` ‡πÉ‡∏ô‡∏Ñ‡∏≠‡∏ô‡πÄ‡∏ó‡∏ô‡πÄ‡∏ô‡∏≠‡∏£‡πå  ‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á‡πÑ‡∏ü‡∏•‡πå‡πÉ‡∏ô‡πÇ‡∏ü‡∏•‡πÄ‡∏î‡∏≠‡∏£‡πå `./html` ‡∏à‡∏∞‡∏°‡∏µ‡∏ú‡∏•‡πÉ‡∏ô‡∏Ñ‡∏≠‡∏ô‡πÄ‡∏ó‡∏ô‡πÄ‡∏ô‡∏≠‡∏£‡πå‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
        - **Named volume:** `db-data:/var/lib/mysql` (‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö `volumeName:containerPath`) ‡∏Ñ‡∏∑‡∏≠‡∏Å‡∏≤‡∏£ mount named volume ‡∏ä‡∏∑‡πà‡∏≠ `db-data` ‡πÑ‡∏õ‡∏¢‡∏±‡∏á `/var/lib/mysql` ‡πÉ‡∏ô‡∏Ñ‡∏≠‡∏ô‡πÄ‡∏ó‡∏ô‡πÄ‡∏ô‡∏≠‡∏£‡πå  Named volume ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÇ‡∏î‡∏¢ Docker ‡πÅ‡∏•‡∏∞‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏∑‡∏î‡∏´‡∏¢‡∏∏‡πà‡∏ô‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤ bind mount
    - `networks`:  ‡∏Å‡∏≥‡∏´‡∏ô‡∏î network ‡∏ó‡∏µ‡πà service ‡∏ô‡∏µ‡πâ‡∏à‡∏∞‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°  `app-network` ‡∏´‡∏°‡∏≤‡∏¢‡∏ñ‡∏∂‡∏á service `web` ‡∏à‡∏∞‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô network ‡∏ó‡∏µ‡πà‡∏ä‡∏∑‡πà‡∏≠ `app-network`

- `db`: ‡∏ä‡∏∑‡πà‡∏≠ service ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö database server (MySQL ‡πÉ‡∏ô‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡∏µ‡πâ)
    - `environment`:  ‡∏Å‡∏≥‡∏´‡∏ô‡∏î environment variables ‡πÉ‡∏´‡πâ‡∏Å‡∏±‡∏ö‡∏Ñ‡∏≠‡∏ô‡πÄ‡∏ó‡∏ô‡πÄ‡∏ô‡∏≠‡∏£‡πå  `MYSQL_ROOT_PASSWORD: secret` ‡πÅ‡∏•‡∏∞ `MYSQL_DATABASE: myapp_db` ‡∏Ñ‡∏∑‡∏≠‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ environment variables ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö MySQL
    - ‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏≠‡∏∑‡πà‡∏ô‡πÜ ‡∏Ñ‡∏•‡πâ‡∏≤‡∏¢‡∏Å‡∏±‡∏ö service `web`

### ‡∏™‡πà‡∏ß‡∏ô‡πÄ‡∏™‡∏£‡∏¥‡∏°‡∏≠‡∏∑‡πà‡∏ô ‡πÜ (Optional)

- `volumes`:  ‡∏™‡πà‡∏ß‡∏ô‡∏ô‡∏µ‡πâ‡πÉ‡∏ä‡πâ‡∏Å‡∏≥‡∏´‡∏ô‡∏î **named volumes** ‡∏ó‡∏µ‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ô‡∏≥‡πÑ‡∏õ‡πÉ‡∏ä‡πâ‡πÉ‡∏ô service ‡∏ï‡πà‡∏≤‡∏á‡πÜ ‡πÑ‡∏î‡πâ  Named volumes ‡∏ä‡πà‡∏ß‡∏¢‡πÉ‡∏´‡πâ‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ volume ‡πÄ‡∏õ‡πá‡∏ô‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏•‡∏∞‡∏á‡πà‡∏≤‡∏¢‡∏ï‡πà‡∏≠‡∏Å‡∏≤‡∏£‡∏ô‡∏≥‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤‡πÉ‡∏ä‡πâ‡πÉ‡∏´‡∏°‡πà
    - `db-data:`  ‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏® named volume ‡∏ä‡∏∑‡πà‡∏≠ `db-data`  Docker ‡∏à‡∏∞‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÅ‡∏•‡∏∞‡∏î‡∏π‡πÅ‡∏• volume ‡∏ô‡∏µ‡πâ

- `networks`:  ‡∏™‡πà‡∏ß‡∏ô‡∏ô‡∏µ‡πâ‡πÉ‡∏ä‡πâ‡∏Å‡∏≥‡∏´‡∏ô‡∏î **networks** ‡∏ó‡∏µ‡πà‡∏Ñ‡∏≠‡∏ô‡πÄ‡∏ó‡∏ô‡πÄ‡∏ô‡∏≠‡∏£‡πå‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏ñ‡∏∂‡∏á‡∏Å‡∏±‡∏ô‡πÑ‡∏î‡πâ
    - `app-network`:  ‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏® network ‡∏ä‡∏∑‡πà‡∏≠ `app-network`
        - `driver: bridge`: ‡∏Å‡∏≥‡∏´‡∏ô‡∏î driver ‡∏Ç‡∏≠‡∏á network ‡πÄ‡∏õ‡πá‡∏ô `bridge` (‡πÄ‡∏õ‡πá‡∏ô driver default)  Docker ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö network driver ‡∏´‡∏•‡∏≤‡∏¢‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó ‡πÄ‡∏ä‡πà‡∏ô `bridge`, `host`, `overlay` ‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡πâ‡∏ô

- `depends_on`: (Optional ‡πÅ‡∏ï‡πà‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç) ‡πÉ‡∏ä‡πâ‡∏£‡∏∞‡∏ö‡∏∏‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏Ç‡∏≠‡∏á service  ‡πÄ‡∏ä‡πà‡∏ô

```yaml
services:
  web:
    # ...
    depends_on:
      - app # web service ‡∏à‡∏∞‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å app service ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÅ‡∏•‡πâ‡∏ß
  app:
    # ...
    depends_on:
      - db # app service ‡∏à‡∏∞‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å db service ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÅ‡∏•‡πâ‡∏ß
  db:
    # ...
```
- `depends_on` ‡∏ä‡πà‡∏ß‡∏¢‡πÉ‡∏´‡πâ‡∏°‡∏±‡πà‡∏ô‡πÉ‡∏à‡∏ß‡πà‡∏≤ service ‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏û‡∏∂‡πà‡∏á‡∏û‡∏≤‡∏Å‡∏±‡∏ô‡∏à‡∏∞‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡πÉ‡∏ô‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á  ‡πÉ‡∏ô‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡∏µ‡πâ `db` ‡∏à‡∏∞‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏Å‡πà‡∏≠‡∏ô, ‡∏ï‡∏≤‡∏°‡∏î‡πâ‡∏ß‡∏¢ `app`, ‡πÅ‡∏•‡∏∞‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢‡∏Ñ‡∏∑‡∏≠ `web`

- `build`: (Optional) ‡πÉ‡∏ä‡πâ build Docker image ‡∏à‡∏≤‡∏Å Dockerfile ‡πÇ‡∏î‡∏¢‡∏ï‡∏£‡∏á‡πÉ‡∏ô `docker-compose.yaml`

```yaml
services:
  app:
    build:
      context: ./app # ‡πÇ‡∏ü‡∏•‡πÄ‡∏î‡∏≠‡∏£‡πå context ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö build image (‡πÄ‡∏ä‡πà‡∏ô ‡πÇ‡∏ü‡∏•‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏ó‡∏µ‡πà‡∏°‡∏µ Dockerfile)
      dockerfile: Dockerfile.dev # ‡∏ä‡∏∑‡πà‡∏≠ Dockerfile (‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ä‡∏∑‡πà‡∏≠ Dockerfile)
    # ...
```
- `build` ‡∏ä‡πà‡∏ß‡∏¢‡πÉ‡∏´‡πâ‡∏Ñ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ build image ‡∏Ç‡∏≠‡∏á‡πÅ‡∏≠‡∏õ‡∏û‡∏•‡∏¥‡πÄ‡∏Ñ‡∏ä‡∏±‡∏ô‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏î‡πâ‡πÇ‡∏î‡∏¢‡∏ï‡∏£‡∏á‡∏à‡∏≤‡∏Å Docker Compose ‡πÇ‡∏î‡∏¢‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á build image ‡πÅ‡∏¢‡∏Å‡∏ï‡πà‡∏≤‡∏á‡∏´‡∏≤‡∏Å‡∏î‡πâ‡∏ß‡∏¢‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á `docker build`

- **‡∏≠‡∏∑‡πà‡∏ô ‡πÜ:** ‡∏¢‡∏±‡∏á‡∏°‡∏µ options ‡∏≠‡∏∑‡πà‡∏ô ‡πÜ ‡∏≠‡∏µ‡∏Å‡∏°‡∏≤‡∏Å‡∏°‡∏≤‡∏¢‡∏ó‡∏µ‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÉ‡∏ä‡πâ‡πÉ‡∏ô `docker-compose.yaml` ‡πÄ‡∏ä‡πà‡∏ô `restart`, `environment_file`, `logging`, `healthcheck`, `deploy` (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Docker Swarm)  ‡∏Ñ‡∏∏‡∏ì‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°‡πÑ‡∏î‡πâ‡∏à‡∏≤‡∏Å‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£ Docker Compose ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£

‡∏≠‡πà‡∏≤‡∏ô‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°‡πÑ‡∏î‡πâ‡∏ó‡∏µ‡πà Docker Compose Reference
[https://docs.docker.com/reference/compose-file/](https://docs.docker.com/reference/compose-file/)


# Section 1: Preparation

‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á Docker ‡∏ï‡∏≤‡∏° [Lab Week 13](/Week%2013%20-%20Containerization%20with%20Docker/) ‡πÉ‡∏´‡πâ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡∏Å‡πà‡∏≠‡∏ô‡∏ñ‡∏∂‡∏á‡∏à‡∏∞‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ó‡∏≥‡∏ï‡πà‡∏≠‡πÑ‡∏î‡πâ ‡∏ñ‡πâ‡∏≤‡πÉ‡∏ä‡πâ‡∏Ñ‡∏≠‡∏°‡∏´‡πâ‡∏≠‡∏á Lab 304 ‡∏Ñ‡∏ß‡∏£‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢</br></br>
![alt text](./image/docker-desktop.png)

# Section 2: Let's Begin!

### ‡πÑ‡∏ü‡∏•‡πå‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ó‡∏≥ Lab ‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ
‡πÉ‡∏ä‡πâ‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á `git clone` ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏∂‡∏á‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏µ‡πà‡∏à‡∏∞‡πÉ‡∏ä‡πâ‡πÉ‡∏ô Lab ‡∏Ñ‡∏∑‡∏≠ folder `/Week 14 Docker Compose/demo-app` ‡πÉ‡∏ô Folder `Week 14 Docker Compose`

```git
git clone https://github.com/Krit789/COOS67-Labs.git
```

### ‡πÄ‡∏õ‡∏¥‡∏î VS Code ‡πÉ‡∏ô Folder `demo-app` ‡∏à‡∏∞‡∏°‡∏µ‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏î‡∏±‡∏á‡∏ô‡∏µ‡πâ
![alt text](./image/proj-struc.png)

‡∏ñ‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡∏à‡∏∏‡∏î‡∏ô‡∏µ‡πâ‡πÅ‡∏•‡πâ‡∏ß ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ó‡∏≥ Lab ‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢ ü•≥

# Section 3: Docker Compose

## 3.1 Introduction
Diagram ‡∏Ç‡∏≠‡∏á‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏≤‡∏à‡∏∞‡∏ó‡∏≥‡πÉ‡∏ô‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ ‡πÄ‡∏£‡∏≤‡∏à‡∏∞‡∏ó‡∏≥‡∏Å‡∏≤‡∏£ Deploy Node.js Express Application ‡∏ó‡∏µ‡πà‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏Å‡∏±‡∏ö MariaDB ‡πÅ‡∏•‡∏∞‡∏°‡∏µ Nginx ‡∏ó‡∏≥‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà Reverse Proxy ‡πÉ‡∏´‡πâ
<p align="center">
<img src="./image/DockerDiagram.png" width="500px" alt="Docker Diagram" />
</p>

‡πÇ‡∏î‡∏¢‡πÄ‡∏£‡∏≤‡∏à‡∏∞‡∏™‡∏£‡πâ‡∏≤‡∏á 3 Container ‡∏î‡πâ‡∏ß‡∏¢ Docker Compose ‡∏ã‡∏∂‡πà‡∏á‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö‡∏î‡πâ‡∏ß‡∏¢
- **Node.js Application** (Express.js, EJS) ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏£‡∏±‡∏ô Application ‡∏´‡∏•‡∏±‡∏Å
  - üñß ‡πÄ‡∏õ‡∏¥‡∏î Port TCP `3000` ‡πÉ‡∏´‡πâ Container ‡∏≠‡∏∑‡πà‡∏ô ‡πÜ ‡πÉ‡∏ô Docker Network ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏™‡∏∑‡πà‡∏≠‡∏™‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏°‡∏≤‡πÑ‡∏î‡πâ‡∏î‡πâ‡∏ß‡∏¢‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á `expose` 
  - üíö ‡πÉ‡∏ä‡πâ `depends_on` ‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏£‡∏≠‡πÉ‡∏´‡πâ MariaDB ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÄ‡∏™‡∏£‡πá‡∏à‡πÅ‡∏ö‡∏ö **Healthy** ‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏° Container ‡∏ô‡∏µ‡πâ
- **MariaDB** Database Management System ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏à‡∏±‡∏î‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Task ‡∏Ç‡∏≠‡∏á‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÅ‡∏ö‡∏ö Persistent
  - üñß ‡πÄ‡∏õ‡∏¥‡∏î Port TCP `3306` ‡πÉ‡∏´‡πâ Container ‡∏≠‡∏∑‡πà‡∏ô ‡πÜ ‡πÉ‡∏ô Docker Network ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏™‡∏∑‡πà‡∏≠‡∏™‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏°‡∏≤‡πÑ‡∏î‡πâ‡∏î‡πâ‡∏ß‡∏¢‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á `expose`
  - ‚õÉ ‡∏ó‡∏≥‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ Bind Mount Folder `./mariadb:/var/lib/mysql` ‡πÉ‡∏ô‡∏Å‡∏≤‡∏£ Mount Volume ‡∏à‡∏≤‡∏Å Folder ‡∏ä‡∏∑‡πà‡∏≠ `mariadb` ‡πÄ‡∏Ç‡πâ‡∏≤‡∏Å‡∏±‡∏ö Container MariaDB ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏Ñ‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Database ‡πÑ‡∏ß‡πâ‡∏ï‡∏•‡∏≠‡∏î (‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏•‡∏ö‡∏ï‡∏≠‡∏ô down ‡∏´‡∏£‡∏∑‡∏≠ restart container ‡∏ô‡∏±‡πâ‡∏ô ‡πÜ)
  - ü©∫ ‡∏ó‡∏≥‡∏Å‡∏≤‡∏£ `healthcheck` container ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤ Database ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ‡∏à‡∏£‡∏¥‡∏á ‡πÜ ‡∏´‡∏£‡∏∑‡∏≠‡∏¢‡∏±‡∏á
      **‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á**
      ```yml
      healthcheck:
        test: ["CMD", "healthcheck.sh", "--connect", "--innodb_initialized"]
        start_period: 10s
        interval: 10s
        timeout: 5s
        retries: 3
      ```

- **Nginx** Webserver ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ó‡∏≥ Reverse Proxy
  - üåê ‡πÄ‡∏õ‡∏¥‡∏î Port TCP `80` ‡πÉ‡∏´‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡πÑ‡∏î‡πâ‡∏†‡∏≤‡∏¢‡∏ô‡∏≠‡∏Å‡∏î‡πâ‡∏ß‡∏¢‡∏î‡πâ‡∏ß‡∏¢‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á `ports`
  - ‚õÉ ‡∏ó‡∏≥‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ Bind Mount ‡πÑ‡∏ü‡∏•‡πå Nginx config (`nginx.conf`) `./nginx/nginx.conf:/etc/nginx/nginx.conf:ro` ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ nginx ‡πÉ‡∏ä‡πâ config ‡∏à‡∏≤‡∏Å‡∏†‡∏≤‡∏¢‡∏ô‡∏≠‡∏Å Container ‡πÑ‡∏î‡πâ‡πÅ‡∏ö‡∏ö read-only (‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏•‡∏ö‡∏ï‡∏≠‡∏ô down ‡∏´‡∏£‡∏∑‡∏≠ restart container ‡∏ô‡∏±‡πâ‡∏ô ‡πÜ)
  - ‚ù§Ô∏è ‡πÉ‡∏ä‡πâ `depends_on` ‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏£‡∏≠‡πÉ‡∏´‡πâ Node.js Applicaiton ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏° Container ‡∏ô‡∏µ‡πâ

## 3.2 MariaDB Setup

> [!WARNING]
> * ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤ Indent ‡πÉ‡∏´‡πâ‡∏ñ‡∏π‡∏Å‡∏•‡∏≥‡∏î‡∏±‡∏ö ‡πÇ‡∏î‡∏¢‡∏Ñ‡∏≥‡∏ß‡πà‡∏≤ `db` ‡∏Ñ‡∏ß‡∏£‡∏≠‡∏¢‡∏π‡πà‡∏£‡∏∞‡∏î‡∏±‡∏ö‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ö `app` ‡πÅ‡∏•‡∏∞‡∏ï‡πà‡∏≠ ‡πÜ ‡πÑ‡∏õ
> * `["CMD", "healthcheck.sh", "--connect", "--innodb_initialized"]` ‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏õ‡πá‡∏ô‡πÅ‡∏ö‡∏ö‡∏ô‡∏µ‡πâ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô **‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÄ‡∏ß‡πâ‡∏ô‡∏ß‡∏£‡∏£‡∏Ñ** ‡∏ï‡∏¥‡∏î‡∏Å‡∏±‡∏ô‡πÉ‡∏´‡πâ‡∏´‡∏°‡∏î ‡πÑ‡∏°‡πà‡∏á‡∏±‡πâ‡∏ô Container ‡∏à‡∏∞‡πÑ‡∏°‡πà Healthy

‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£<u>**‡πÄ‡∏û‡∏¥‡πà‡∏°**</u> MariaDB ‡∏ï‡πà‡∏≠‡πÄ‡∏Ç‡πâ‡∏≤‡πÑ‡∏õ‡πÉ‡∏ô‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà Comment ‡πÑ‡∏ß‡πâ‡πÉ‡∏ô‡πÑ‡∏ü‡∏•‡πå `docker-compose.yml` ‡πÉ‡∏ô Folder `demo-app` ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á Container ‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏£‡∏±‡∏ô Database ‡∏Ç‡∏≠‡∏á‡πÄ‡∏£‡∏≤‡∏Ç‡∏∂‡πâ‡∏ô‡∏°‡∏≤<br/>
![alt text](./image/compose-db.png)

‡∏™‡πà‡∏ß‡∏ô‡∏ô‡∏µ‡πâ‡∏à‡∏∞‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏Å‡∏≤‡∏£ Container ‡∏Ç‡∏≠‡∏á MariaDB ‡πÇ‡∏î‡∏¢‡∏à‡∏∞‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏à‡∏∞‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏î‡∏±‡∏á‡∏ô‡∏µ‡πâ:

*   **`db`**: ‡∏ä‡∏∑‡πà‡∏≠‡∏Ç‡∏≠‡∏á service ‡∏ô‡∏µ‡πâ ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ï‡∏±‡πâ‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏≠‡∏∞‡πÑ‡∏£‡∏Å‡πá‡πÑ‡∏î‡πâ ‡πÅ‡∏ï‡πà‡πÉ‡∏ô‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πâ‡πÉ‡∏™‡πà‡πÄ‡∏õ‡πá‡∏ô db
*   **`container_name: coos_task_db`**:  ‡∏ï‡∏±‡πâ‡∏á‡∏ä‡∏∑‡πà‡∏≠ container ‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡∏∂‡πâ‡∏ô‡∏ß‡πà‡∏≤ `coos_task_db`
*   **`image: mariadb:lts`**: ‡πÉ‡∏ä‡πâ image `mariadb` ‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏ä‡∏±‡∏ô LTS (Long Term Support) ‡∏ã‡∏∂‡πà‡∏á‡∏à‡∏∞‡∏ñ‡∏π‡∏Å [pull ‡∏°‡∏≤‡∏à‡∏≤‡∏Å Docker Hub ‡πÇ‡∏î‡∏¢‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥](https://hub.docker.com/_/mariadb)
*   **`restart: unless-stopped`**:  ‡∏ñ‡πâ‡∏≤ container ‡∏´‡∏¢‡∏∏‡∏î‡∏ó‡∏≥‡∏á‡∏≤‡∏ô, ‡πÉ‡∏´‡πâ restart ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥ ‡∏¢‡∏Å‡πÄ‡∏ß‡πâ‡∏ô‡∏ß‡πà‡∏≤‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏™‡∏±‡πà‡∏á‡∏´‡∏¢‡∏∏‡∏î‡πÇ‡∏î‡∏¢‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ (`docker compose down`)
*   **`expose: - "3306"`**: ‡πÄ‡∏õ‡∏¥‡∏î port 3306 ‡∏†‡∏≤‡∏¢‡πÉ‡∏ô container (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÉ‡∏´‡πâ container ‡∏≠‡∏∑‡πà‡∏ô ‡πÜ ‡πÉ‡∏ô network ‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÑ‡∏î‡πâ) *‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ* expose port ‡∏ô‡∏µ‡πâ‡πÑ‡∏õ‡∏¢‡∏±‡∏á host machine (‡πÄ‡∏Ç‡πâ‡∏≤‡∏à‡∏≤‡∏Å‡∏Ç‡πâ‡∏≤‡∏á‡∏ô‡∏≠‡∏Å‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ)
*   **`volumes: - ./mariadb:/var/lib/mysql`**:  ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡πÇ‡∏¢‡∏á Folder `./mariadb` ‡∏ö‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á host (‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏≤‡∏™‡∏±‡πà‡∏á `docker compose up`) ‡πÄ‡∏Ç‡πâ‡∏≤‡∏Å‡∏±‡∏ö Folder `/var/lib/mysql` ‡∏†‡∏≤‡∏¢‡πÉ‡∏ô container  (‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ç‡∏≠‡∏á MariaDB ‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡πÄ‡∏Å‡πá‡∏ö‡πÑ‡∏ß‡πâ‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏´‡∏≤‡∏¢‡πÑ‡∏õ‡πÄ‡∏°‡∏∑‡πà‡∏≠ container ‡∏ñ‡∏π‡∏Å‡∏•‡∏ö)
*   **`environment`**: ‡∏Å‡∏≥‡∏´‡∏ô‡∏î environment variables ‡∏†‡∏≤‡∏¢‡πÉ‡∏ô container:
    *   **`MARIADB_ROOT_PASSWORD: changeme`**:  ‡∏ï‡∏±‡πâ‡∏á‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô root ‡∏Ç‡∏≠‡∏á MariaDB ‡πÄ‡∏õ‡πá‡∏ô `changeme` (**‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏°‡∏≤‡∏Å:** ‡∏Ñ‡∏ß‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡∏ô‡∏µ‡πâ‡πÉ‡∏´‡πâ‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢‡∏Å‡∏ß‡πà‡∏≤‡∏ô‡∏µ‡πâ‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏à‡∏£‡∏¥‡∏á)
    *   **`TZ: Asia/Bangkok`**:  ‡∏ï‡∏±‡πâ‡∏á Timezone ‡πÄ‡∏õ‡πá‡∏ô Asia/Bangkok
*  **`healthcheck`**:  ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö health check ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ Docker ‡∏£‡∏π‡πâ‡∏ß‡πà‡∏≤ container ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏õ‡∏Å‡∏ï‡∏¥‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà (healthy ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà):
    * **`test`**: ‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö  ‡πÉ‡∏ä‡πâ‡∏™‡∏Ñ‡∏£‡∏¥‡∏õ‡∏ï‡πå `healthcheck.sh` [‡∏ï‡∏≤‡∏° Docs ‡∏Ç‡∏≠‡∏á MariaDB](https://mariadb.com/kb/en/using-healthcheck-sh/) ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏ä‡πá‡∏Ñ‡∏ß‡πà‡∏≤ MariaDB ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÑ‡∏î‡πâ‡πÅ‡∏•‡∏∞ InnoDB engine ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÅ‡∏•‡πâ‡∏ß
    * **`start_period`**: ‡∏£‡∏≠ 10 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ ‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å container ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ó‡∏≥‡∏á‡∏≤‡∏ô ‡∏Å‡πà‡∏≠‡∏ô‡∏à‡∏∞‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ó‡∏≥ health check ‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÅ‡∏£‡∏Å
    * **`interval`**: ‡∏ó‡∏≥ health check ‡∏ó‡∏∏‡∏Å ‡πÜ 10 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ
    * **`timeout`**:  ‡∏ñ‡πâ‡∏≤ health check ‡πÉ‡∏ä‡πâ‡πÄ‡∏ß‡∏•‡∏≤‡∏ô‡∏≤‡∏ô‡∏Å‡∏ß‡πà‡∏≤ 5 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ ‡∏ñ‡∏∑‡∏≠‡∏ß‡πà‡∏≤‡πÑ‡∏°‡πà‡∏ú‡πà‡∏≤‡∏ô 
    * **`retries`**:  ‡∏•‡∏≠‡∏á‡∏ó‡∏≥ health check ‡∏ã‡πâ‡∏≥ 3 ‡∏Ñ‡∏£‡∏±‡πâ‡∏á ‡∏ñ‡πâ‡∏≤‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏ú‡πà‡∏≤‡∏ô ‡∏ñ‡∏∑‡∏≠‡∏ß‡πà‡∏≤ container ‡πÑ‡∏°‡πà healthy

**‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏**

*   ‡∏ñ‡πâ‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡πâ application ‡∏≠‡∏∑‡πà‡∏ô ‡πÜ *‡∏ô‡∏≠‡∏Å Docker network* ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á database ‡∏ô‡∏µ‡πâ‡πÑ‡∏î‡πâ, ‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏ä‡πâ `ports` ‡πÅ‡∏ó‡∏ô `expose`  ‡πÄ‡∏ä‡πà‡∏ô `ports: - "3306:3306"` (‡πÅ‡∏ï‡πà‡∏£‡∏∞‡∏ß‡∏±‡∏á‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢‡∏î‡πâ‡∏ß‡∏¢)

## 3.3 Node.js Application Setup

> [!WARNING]
> ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤ Indent ‡πÉ‡∏´‡πâ‡∏ñ‡∏π‡∏Å‡∏•‡∏≥‡∏î‡∏±‡∏ö ‡πÇ‡∏î‡∏¢‡∏Ñ‡∏≥‡∏ß‡πà‡∏≤ `db` ‡∏Ñ‡∏ß‡∏£‡∏≠‡∏¢‡∏π‡πà‡∏£‡∏∞‡∏î‡∏±‡∏ö‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ö `app` ‡πÅ‡∏•‡∏∞‡∏ï‡πà‡∏≠ ‡πÜ ‡πÑ‡∏õ

‡πÉ‡∏ô‡∏™‡πà‡∏ß‡∏ô‡∏ï‡πà‡∏≠‡∏°‡∏≤<u>**‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç**</u> app service ‡πÉ‡∏ô‡πÑ‡∏ü‡∏•‡πå `docker-compose.yml` ‡πÉ‡∏ô Folder `demo-app` ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏≤‡∏à‡∏∞‡∏ó‡∏≥‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Node.js Applicaion Container ‡πÇ‡∏î‡∏¢‡πÄ‡∏£‡∏≤‡∏à‡∏∞‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏° Environment ‡∏ó‡∏µ‡πà‡∏ï‡∏±‡πâ‡∏á‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡∏ó‡∏≥ MariaDB Container ‡πÉ‡∏ô‡∏™‡πà‡∏ß‡∏ô‡∏Å‡πà‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤ ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ Database ‡πÑ‡∏î‡πâ ‡πÅ‡∏•‡∏∞‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡πà‡∏ß‡∏ô `depends_on` ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏£‡∏≠‡πÉ‡∏´‡πâ Database ‡∏ô‡∏±‡πâ‡∏ô Healthy ‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏° Application<br/>
![alt text](./image/compose-node.png)
‡∏ô‡∏µ‡πà‡∏Ñ‡∏∑‡∏≠‡∏™‡πà‡∏ß‡∏ô‡∏Ç‡∏≠‡∏á‡πÑ‡∏ü‡∏•‡πå Docker Compose ‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Ñ‡πà‡∏≤‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö service ‡∏Ç‡∏≠‡∏á‡πÅ‡∏≠‡∏õ‡∏û‡∏•‡∏¥‡πÄ‡∏Ñ‡∏ä‡∏±‡∏ô (‡∏ô‡πà‡∏≤‡∏à‡∏∞‡πÄ‡∏õ‡πá‡∏ô Node.js application):

*   **`container_name: coos_task_app`**: ‡∏ï‡∏±‡πâ‡∏á‡∏ä‡∏∑‡πà‡∏≠ container ‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ß‡πà‡∏≤ `coos_task_app`
*   **`build: .`**:  ‡∏ö‡∏≠‡∏Å‡πÉ‡∏´‡πâ Docker build image ‡∏à‡∏≤‡∏Å Dockerfile ‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô directory ‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô (`.`)  (‡∏Ñ‡∏∑‡∏≠ directory ‡∏ó‡∏µ‡πà‡∏°‡∏µ‡πÑ‡∏ü‡∏•‡πå `docker-compose.yml` ‡∏ô‡∏µ‡πâ‡∏≠‡∏¢‡∏π‡πà ‡∏ã‡∏∂‡πà‡∏á‡∏Å‡πá‡∏°‡∏µ‡πÑ‡∏ü‡∏•‡πå `Dockerfile` ‡∏≠‡∏¢‡∏π‡πà‡∏î‡πâ‡∏ß‡∏¢)
*   **`restart: unless-stopped`**: ‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡∏Å‡∏±‡∏ö‡πÉ‡∏ô service `db`: ‡∏ñ‡πâ‡∏≤ container ‡∏´‡∏¢‡∏∏‡∏î‡∏ó‡∏≥‡∏á‡∏≤‡∏ô ‡πÉ‡∏´‡πâ restart ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥ ‡∏¢‡∏Å‡πÄ‡∏ß‡πâ‡∏ô‡∏ß‡πà‡∏≤‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏™‡∏±‡πà‡∏á‡∏´‡∏¢‡∏∏‡∏î‡πÇ‡∏î‡∏¢‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ (`docker compose down`)
*   **`ports: - "3000:3000/tcp"`**:  ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏° port 3000 ‡∏Ç‡∏≠‡∏á host machine ‡πÄ‡∏Ç‡πâ‡∏≤‡∏Å‡∏±‡∏ö port 3000 ‡∏Ç‡∏≠‡∏á container  (‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡πÄ‡∏£‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á application ‡πÑ‡∏î‡πâ‡∏ú‡πà‡∏≤‡∏ô browser ‡πÇ‡∏î‡∏¢‡πÑ‡∏õ‡∏ó‡∏µ‡πà [http://localhost:3000](http://localhost:3000) ‡∏´‡∏£‡∏∑‡∏≠ IP address ‡∏Ç‡∏≠‡∏á‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á host ‡∏ó‡∏µ‡πà port 3000) ‡∏´‡∏£‡∏∑‡∏≠‡∏•‡∏≠‡∏á‡πÉ‡∏´‡πâ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡∏à‡∏≤‡∏Å‡∏î‡∏π‡∏Å‡πá‡πÑ‡∏î‡πâ
    * `/tcp` ‡∏£‡∏∞‡∏ö‡∏∏‡∏ß‡πà‡∏≤‡πÄ‡∏õ‡πá‡∏ô protocol TCP
*   **`depends_on`**:  ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏ß‡πà‡∏≤ service ‡∏ô‡∏µ‡πâ‡∏Ç‡∏∂‡πâ‡∏ô‡∏≠‡∏¢‡∏π‡πà‡∏Å‡∏±‡∏ö service ‡∏≠‡∏∑‡πà‡∏ô:
    *   **`db`**:  ‡∏Ç‡∏∂‡πâ‡∏ô‡∏≠‡∏¢‡∏π‡πà‡∏Å‡∏±‡∏ö service ‡∏ó‡∏µ‡πà‡∏ä‡∏∑‡πà‡∏≠‡∏ß‡πà‡∏≤ `db` (‡∏Å‡πá‡∏Ñ‡∏∑‡∏≠ MariaDB ‡∏™‡πà‡∏ß‡∏ô‡∏Å‡πà‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤)
    *   **`condition: service_healthy`**:  ‡∏à‡∏∞‡πÄ‡∏£‡∏¥‡πà‡∏° service `coos_task_app` *‡∏Å‡πá‡∏ï‡πà‡∏≠‡πÄ‡∏°‡∏∑‡πà‡∏≠* service `db` ‡∏°‡∏µ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ "healthy" (‡∏ú‡πà‡∏≤‡∏ô health heck ‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏≤‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÑ‡∏ß‡πâ‡πÉ‡∏ô service `db`) ‡πÇ‡∏î‡∏¢‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÑ‡∏î‡πâ‡∏à‡∏≤‡∏Å‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á `docker ps` ‡πÉ‡∏ô Column `STATUS` ‡∏à‡∏∞‡∏°‡∏µ `(healthy)` ‡∏ï‡πà‡∏≠‡∏´‡∏•‡∏±‡∏á Uptime
*   **`environment`**: ‡∏Å‡∏≥‡∏´‡∏ô‡∏î environment variables ‡∏†‡∏≤‡∏¢‡πÉ‡∏ô container:
    *   **`PORT: 3000`**:  ‡∏ö‡∏≠‡∏Å‡πÉ‡∏´‡πâ application ‡∏£‡∏±‡∏ô‡∏ó‡∏µ‡πà port 3000 (‡∏ã‡∏∂‡πà‡∏á‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏≤ expose port ‡πÑ‡∏ß‡πâ)
    *   **`NODE_ENV: production`**:  ‡∏ö‡∏≠‡∏Å‡∏ß‡πà‡∏≤‡πÄ‡∏õ‡πá‡∏ô environment production (Node.js application ‡∏°‡∏±‡∏Å‡∏à‡∏∞‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏ó‡∏µ‡πà‡∏ï‡πà‡∏≤‡∏á‡∏Å‡∏±‡∏ô‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á development ‡∏Å‡∏±‡∏ö production)
    *   **`DB_HOST: db`**:  hostname ‡∏Ç‡∏≠‡∏á database ‡∏Ñ‡∏∑‡∏≠ `db` (‡∏ã‡∏∂‡πà‡∏á‡∏Å‡πá‡∏Ñ‡∏∑‡∏≠‡∏ä‡∏∑‡πà‡∏≠ service ‡∏Ç‡∏≠‡∏á MariaDB ‡πÉ‡∏ô Docker Network ‡∏ã‡∏∂‡πà‡∏á‡∏à‡∏∞‡∏ó‡∏≥‡πÉ‡∏´‡πâ container ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏Ñ‡∏∏‡∏¢‡∏Å‡∏±‡∏ô‡πÑ‡∏î‡πâ‡πÇ‡∏î‡∏¢‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥)
    *   **`DB_USER: root`**:  username ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ database ‡∏Ñ‡∏∑‡∏≠ `root`
    *   **`DB_PASSWORD: changeme`**:  ‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ database (<u>**‡∏ï‡πâ‡∏≠‡∏á‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡∏ó‡∏µ‡πà‡∏ï‡∏±‡πâ‡∏á‡πÑ‡∏ß‡πâ‡πÉ‡∏ô service `db`**</u>).
    *   **`DB_NAME: task_manager`**:  ‡∏ä‡∏∑‡πà‡∏≠‡∏Ç‡∏≠‡∏á database ‡∏ó‡∏µ‡πà‡∏à‡∏∞‡πÉ‡∏ä‡πâ
    *   **`TZ: Asia/Bangkok`**:  ‡∏ï‡∏±‡πâ‡∏á Timezone ‡πÄ‡∏õ‡πá‡∏ô Asia/Bangkok

## 3.4 üö© Checkpoint #1
‡∏ó‡∏î‡∏•‡∏≠‡∏á‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô Docker Container ‡∏ó‡∏µ‡πà‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡∏∂‡πâ‡∏ô‡∏à‡∏≤‡∏Å Docker Compose ‡∏ñ‡∏∂‡∏á‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ‡∏î‡πâ‡∏ß‡∏¢‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ô‡∏µ‡πâ **‡πÇ‡∏î‡∏¢‡∏ï‡πâ‡∏≠‡∏á‡∏™‡∏±‡πà‡∏á‡∏à‡∏≤‡∏Å‡πÉ‡∏ô Folder `demo-app` ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô**
```
docker compose up
```
### ‚úÖ ‡∏ñ‡πâ‡∏≤ Console Output ‡∏≠‡∏≠‡∏Å‡∏°‡∏≤‡πÅ‡∏ö‡∏ö‡∏ô‡∏µ‡πâ ‡πÅ‡∏™‡∏î‡∏á‡∏ß‡πà‡∏≤‡∏ó‡∏∏‡∏Å‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á
![alt text](./image/docker-compose-check1.png)

### ‚úÖ ‡∏ñ‡πâ‡∏≤‡πÉ‡∏ä‡πâ Docker Desktop ‡∏≠‡∏≠‡∏Å‡∏°‡∏≤‡πÅ‡∏ö‡∏ö‡∏ô‡∏µ‡πâ ‡∏Å‡πá‡∏ñ‡∏π‡∏Å‡πÄ‡∏ä‡πà‡∏ô‡∏Å‡∏±‡∏ô
![alt text](./image/desktop-check1.png)</br>
![alt text](./image/desktop-check2.png)

### ‚ùå ‡∏Å‡∏£‡∏ì‡∏µ 1 ‡∏ñ‡πâ‡∏≤‡πÄ‡∏Å‡∏¥‡∏î Error ‡πÅ‡∏ö‡∏ö‡∏ô‡∏µ‡πâ‡∏Ç‡∏∂‡πâ‡∏ô (Authentication Failure)
‡πÅ‡∏™‡∏î‡∏á‡∏ß‡πà‡∏≤‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ Database ‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡πÄ‡∏û‡∏£‡∏≤‡∏∞ ‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡∏´‡∏£‡∏∑‡∏≠‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ú‡∏¥‡∏î ‡∏•‡∏≠‡∏á‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÉ‡∏´‡∏°‡πà‡πÅ‡∏•‡πâ‡∏ß‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà ‡∏´‡∏£‡∏∑‡∏≠‡∏•‡∏ö Folder `mariadb` ‡∏ó‡∏¥‡πâ‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏•‡πâ‡∏≤‡∏á‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÅ‡∏•‡∏∞‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÉ‡∏´‡∏°‡πà</br></br>
![alt text](./image/docker-compose-check1-baddb.png)

### ‚ùå ‡∏Å‡∏£‡∏ì‡∏µ 2 ‡∏ñ‡πâ‡∏≤‡πÄ‡∏Å‡∏¥‡∏î Error ‡πÅ‡∏ö‡∏ö‡∏ô‡∏µ‡πâ‡∏Ç‡∏∂‡πâ‡∏ô (depend_on ‡πÑ‡∏°‡πà‡∏Ñ‡∏£‡∏ö)
‡∏Ç‡∏∂‡πâ‡∏ô Error ‡∏ñ‡∏µ‡πà ‡πÜ ‡∏Å‡πà‡∏≠‡∏ô Application ‡∏à‡∏∞ Restart ‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏¢ ‡πÜ ‡πÅ‡∏•‡πâ‡∏ß‡∏Å‡πá‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ‡πÄ‡∏≠‡∏á ‡πÉ‡∏´‡πâ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ `depends_on` ‡πÉ‡∏ô app service ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡πÑ‡∏´‡∏°</br></br>
![alt text](./image/docker-compose-check1-baddepend.png)

### ‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏ó‡∏µ‡πà‡∏Ñ‡∏ß‡∏£‡∏à‡∏∞‡πÑ‡∏î‡πâ
‡∏ó‡∏î‡∏•‡∏≠‡∏á‡πÄ‡∏Ç‡πâ‡∏≤ [http://localhost:3000](http://localhost:3000) ‡∏´‡∏£‡∏∑‡∏≠ IP address ‡∏Ç‡∏≠‡∏á‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á host ‡∏ó‡∏µ‡πà port 3000 ‡πÅ‡∏•‡πâ‡∏ß‡∏Ñ‡∏ß‡∏£‡∏à‡∏∞‡πÑ‡∏î‡πâ‡∏´‡∏ô‡πâ‡∏≤‡∏ô‡∏µ‡πâ<br/><br/>
‡∏ó‡∏î‡∏•‡∏≠‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á Task ‡πÉ‡∏´‡∏°‡πà‡πÅ‡∏•‡πâ‡∏ß‡∏î‡∏π‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå<br/><br/>
![](./image/check1-web1.PNG)<br/><br/>
![](./image/check1-web2.PNG)<br/><br/>
![](./image/check1-web3.PNG)<br/>

‡∏ñ‡πâ‡∏≤‡∏ó‡∏≥‡∏Å‡∏≤‡∏£ down container ‡∏î‡πâ‡∏ß‡∏¢‡∏Å‡∏≤‡∏£‡∏Å‡∏î `Ctrl + C` ‡∏´‡∏£‡∏∑‡∏≠‡πÉ‡∏ä‡πâ‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á
```
docker compose down
```

‡πÅ‡∏•‡πâ‡∏ß‡∏ó‡∏≥‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏´‡∏°‡πà‡∏î‡πâ‡∏ß‡∏¢
```
docker compose up -d
```

‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏Ç‡πâ‡∏≤‡πÑ‡∏õ‡∏ó‡∏µ‡πà‡πÄ‡∏ß‡πá‡∏ö [http://localhost:3000](http://localhost:3000) ‡∏´‡∏£‡∏∑‡∏≠ IP address ‡∏Ç‡∏≠‡∏á‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á host ‡∏ó‡∏µ‡πà port 3000
‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡πÉ‡∏™‡πà‡πÑ‡∏ß‡πâ‡∏Ñ‡∏ß‡∏£‡∏à‡∏∞‡∏≠‡∏¢‡∏π‡πà‡∏Ñ‡∏£‡∏ö<br/><br/>
![](./image/check1-web4.PNG)<br/>

## 3.5 Nginx ‡∏Å‡∏±‡∏ö‡∏Å‡∏≤‡∏£ Reverse Proxy
### ü§î ‡∏ó‡∏≥‡πÑ‡∏°‡∏ï‡πâ‡∏≠‡∏á‡∏ó‡∏≥ Reverse Proxy ‡∏î‡πâ‡∏ß‡∏¢?
*   **HTTPS:** ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ SSL/TLS certificates ‡πÑ‡∏î‡πâ‡∏á‡πà‡∏≤‡∏¢, ‡∏£‡∏ß‡∏°‡∏®‡∏π‡∏ô‡∏¢‡πå, ‡πÅ‡∏•‡∏∞‡πÉ‡∏ä‡πâ [Let's Encrypt](https://letsencrypt.org/) (‡πÉ‡∏ô Lab ‡∏ô‡∏µ‡πâ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÉ‡∏ä‡πâ)
*   **Load Balancing:** ‡∏Å‡∏£‡∏∞‡∏à‡∏≤‡∏¢ traffic ‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡∏´‡∏•‡∏≤‡∏¢ application containers (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ ‡πÉ‡∏ä‡πâ‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á [`upstream`](https://docs.nginx.com/nginx/admin-guide/load-balancer/http-load-balancer/))
*   **Static Content:** ‡πÄ‡∏™‡∏¥‡∏£‡πå‡∏ü‡πÑ‡∏ü‡∏•‡πå static (CSS, JS, ‡∏£‡∏π‡∏õ) ‡πÑ‡∏î‡πâ‡πÄ‡∏£‡πá‡∏ß, ‡∏•‡∏î‡∏†‡∏≤‡∏£‡∏∞ application server
*   **Security:** ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô application, ‡∏Å‡∏£‡∏≠‡∏á requests, ‡∏à‡∏≥‡∏Å‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á (‡πÄ‡∏ä‡πà‡∏ô‡∏ó‡∏≥ [Basic Authentication](https://docs.nginx.com/nginx/admin-guide/security-controls/configuring-http-basic-authentication/) ‡∏´‡∏£‡∏∑‡∏≠ ACL)
*   **Caching:** ‡πÄ‡∏Å‡πá‡∏ö content ‡πÑ‡∏ß‡πâ, ‡∏•‡∏î‡∏†‡∏≤‡∏£‡∏∞ server, ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡πá‡∏ß
*   **Domains:** ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏´‡∏•‡∏≤‡∏¢ domains/subdomains ‡πÉ‡∏ô server ‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏î‡πâ‡∏ß‡∏¢ Virtual Host
*   **URLs:** Rewrite/Redirect URLs ‡πÑ‡∏î‡πâ (‡πÄ‡∏ä‡πà‡∏ô redirect HTTP -> HTTPS)
* **Simplify deployment:** ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏Å‡∏≤‡∏£ deploy ‡∏á‡πà‡∏≤‡∏¢‡πÅ‡∏•‡∏∞‡πÄ‡∏õ‡πá‡∏ô‡∏£‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ö‡∏°‡∏≤‡∏Å‡∏Ç‡∏∂‡πâ‡∏ô

### 3.5.1 ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç app service ‡πÉ‡∏ô‡πÑ‡∏ü‡∏•‡πå `docker-compose.yml`

‡∏ó‡∏≥‡∏Å‡∏≤‡∏£‡∏õ‡∏¥‡∏î Port 3000 ‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏ó‡∏≥‡∏Å‡∏≤‡∏£ Publish ‡πÑ‡∏ß‡πâ‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á `expose` ‡πÅ‡∏ó‡∏ô ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡πÑ‡∏î‡πâ‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÉ‡∏ô Docker Network ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô<br/>

![alt text](./image/compose-remove-port.png)

### 3.5.2 ‡πÄ‡∏û‡∏¥‡πà‡∏° nginx service ‡πÄ‡∏Ç‡πâ‡∏≤‡πÑ‡∏õ‡πÉ‡∏ô‡πÑ‡∏ü‡∏•‡πå `docker-compose.yml`

> [!WARNING]
> ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤ Indent ‡πÉ‡∏´‡πâ‡∏ñ‡∏π‡∏Å‡∏•‡∏≥‡∏î‡∏±‡∏ö ‡πÇ‡∏î‡∏¢‡∏Ñ‡∏≥‡∏ß‡πà‡∏≤ `nginx` ‡∏Ñ‡∏ß‡∏£‡∏≠‡∏¢‡∏π‡πà‡∏£‡∏∞‡∏î‡∏±‡∏ö‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ö `app` ‡πÅ‡∏•‡∏∞ `db` ‡πÅ‡∏•‡∏∞‡∏ï‡πà‡∏≠ ‡πÜ ‡πÑ‡∏õ

<u>**‡πÄ‡∏û‡∏¥‡πà‡∏°**</u>‡∏™‡πà‡∏ß‡∏ô `nginx` service ‡πÄ‡∏Ç‡πâ‡∏≤‡πÑ‡∏õ‡πÉ‡∏ô `docker-compose.yml` <u>**‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏î‡∏¥‡∏°**</u>‡πÉ‡∏ô Folder `demo-app` ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á Container ‡∏ó‡∏µ‡πà‡πÉ‡∏´‡πâ‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£ Reverse Proxy ‡∏Ç‡∏∂‡πâ‡∏ô‡∏°‡∏≤<br/>
![alt text](./image/docker-compose-nginx.png)
 ‡∏ô‡∏µ‡πà‡∏Ñ‡∏∑‡∏≠‡∏™‡πà‡∏ß‡∏ô‡∏Ç‡∏≠‡∏á‡πÑ‡∏ü‡∏•‡πå Docker Compose ‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Ñ‡πà‡∏≤‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö service Nginx ‡∏ã‡∏∂‡πà‡∏á‡∏à‡∏∞‡∏ó‡∏≥‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡πá‡∏ô Reverse Proxy:

*   **`container_name: coos_rev_proxy`**: ‡∏ï‡∏±‡πâ‡∏á‡∏ä‡∏∑‡πà‡∏≠ container ‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ß‡πà‡∏≤ `coos_rev_proxy`
*   **`nginx`**: ‡∏ä‡∏∑‡πà‡∏≠‡∏Ç‡∏≠‡∏á service ‡∏ô‡∏µ‡πâ
*   **`image: nginx:latest`**: ‡πÉ‡∏ä‡πâ image [`nginx` ‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏ä‡∏±‡∏ô‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡∏à‡∏≤‡∏Å Docker Hub](https://hub.docker.com/_/nginx)
*   **`ports: - "80:80/tcp"`**: ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏° port 80 ‡∏Ç‡∏≠‡∏á host machine ‡πÄ‡∏Ç‡πâ‡∏≤‡∏Å‡∏±‡∏ö port 80 ‡∏Ç‡∏≠‡∏á container ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£ HTTP
*   **`restart: unless-stopped`**:  ‡∏ñ‡πâ‡∏≤ container ‡∏´‡∏¢‡∏∏‡∏î‡∏ó‡∏≥‡∏á‡∏≤‡∏ô, ‡πÉ‡∏´‡πâ restart ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥ ‡∏¢‡∏Å‡πÄ‡∏ß‡πâ‡∏ô‡∏ß‡πà‡∏≤‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏™‡∏±‡πà‡∏á‡∏´‡∏¢‡∏∏‡∏î‡πÇ‡∏î‡∏¢‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ
*   **`volumes`**:
    *   **`./nginx/nginx.conf:/etc/nginx/nginx.conf:ro`**:  ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡πÇ‡∏¢‡∏á‡πÑ‡∏ü‡∏•‡πå `nginx.conf` ‡πÉ‡∏ô‡πÇ‡∏ü‡∏•‡πÄ‡∏î‡∏≠‡∏£‡πå `./nginx` ‡∏ö‡∏ô host machine ‡πÄ‡∏Ç‡πâ‡∏≤‡∏Å‡∏±‡∏ö‡πÑ‡∏ü‡∏•‡πå `/etc/nginx/nginx.conf` ‡∏†‡∏≤‡∏¢‡πÉ‡∏ô container ‡πÑ‡∏ü‡∏•‡πå‡∏ô‡∏µ‡πâ‡∏Ñ‡∏∑‡∏≠‡πÑ‡∏ü‡∏•‡πå configuration ‡∏´‡∏•‡∏±‡∏Å‡∏Ç‡∏≠‡∏á Nginx
    * `:ro` ‡∏´‡∏°‡∏≤‡∏¢‡∏ñ‡∏∂‡∏á read-only; container ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÑ‡∏ü‡∏•‡πå configuration ‡∏ô‡∏µ‡πâ‡πÑ‡∏î‡πâ (‡πÄ‡∏õ‡πá‡∏ô best practice ‡∏î‡πâ‡∏≤‡∏ô security)
*   **`depends_on: - app`**:  ‡∏ö‡∏≠‡∏Å‡∏ß‡πà‡∏≤ service `nginx` ‡∏ô‡∏µ‡πâ‡∏Ç‡∏∂‡πâ‡∏ô‡∏≠‡∏¢‡∏π‡πà‡∏Å‡∏±‡∏ö service `app` (Container ‡∏Ç‡∏≠‡∏á Node.js Application ‡∏ó‡∏µ‡πà‡∏ó‡∏≥‡πÑ‡∏õ‡∏Å‡πà‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏ô‡∏µ‡πâ)  Docker Compose ‡∏à‡∏∞‡∏£‡∏≠‡πÉ‡∏´‡πâ‡πÄ service `app` ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏Å‡πà‡∏≠‡∏ô, ‡πÅ‡∏•‡πâ‡∏ß‡∏Ñ‡πà‡∏≠‡∏¢‡πÄ‡∏£‡∏¥‡πà‡∏° service `nginx`  (‡πÑ‡∏°‡πà‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡∏Å‡∏±‡∏ö `db` ‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ `condition: service_healthy` ‡πÄ‡∏û‡∏£‡∏≤‡∏∞ Nginx config ‡∏™‡πà‡∏ß‡∏ô‡πÉ‡∏´‡∏ç‡πà‡∏à‡∏∞‡πÅ‡∏Ñ‡πà forward traffic, ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ interact ‡∏Å‡∏±‡∏ö app ‡πÇ‡∏î‡∏¢‡∏ï‡∏£‡∏á‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô database)
*    **`environment`**:
     *    **`TZ=Asia/Bangkok`**: ‡∏ï‡∏±‡πâ‡∏á Timezone ‡πÄ‡∏õ‡πá‡∏ô Asia/Bangkok (‡∏°‡∏µ‡∏ú‡∏•‡∏ï‡∏≠‡∏ô‡πÄ‡∏Å‡πá‡∏ö‡∏Ñ‡πà‡∏≤‡πÉ‡∏ô Access Logs ‡∏Å‡∏±‡∏ö Error Logs)

### 3.5.3 ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ nginx ‡∏î‡πâ‡∏ß‡∏¢‡πÑ‡∏ü‡∏•‡πå `nginx.conf`
‡∏™‡∏£‡πâ‡∏≤‡∏á Folder ‡πÉ‡∏´‡∏°‡πà‡πÉ‡∏ô Folder `demo-app` ‡∏ä‡∏∑‡πà‡∏≠‡∏ß‡πà‡∏≤ `nginx` ‡πÅ‡∏•‡∏∞‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå `nginx.conf` ‡∏Ç‡∏∂‡πâ‡∏ô‡∏°‡∏≤
```
.
‚îî‚îÄ‚îÄ demo-app/
    ‚îî‚îÄ‚îÄ nginx/
        ‚îî‚îÄ‚îÄ nginx.conf
```

‡πÅ‡∏•‡∏∞‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏ô‡∏µ‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡πÑ‡∏õ‡πÉ‡∏ô `nginx.conf` ‡∏ã‡∏∂‡πà‡∏á‡∏à‡∏∞‡∏ó‡∏≥‡∏Å‡∏≤‡∏£ Reverse Proxy Node.js Application ‡∏à‡∏≤‡∏Å Port 3000 ‡πÉ‡∏ô Docker Network ‡πÑ‡∏õ‡∏™‡∏π‡πà Host Network ‡∏ó‡∏µ‡πà Port 80

**nginx.conf**
```nginx
events {
    worker_connections 4000;
    use                epoll;
    multi_accept       on;
}

http {
    include           mime.types;

    sendfile          on;
    tcp_nopush        on;
    keepalive_timeout 65;

    gzip            on;
    gzip_comp_level 6;

    server {
         listen       80;
         server_name  _;
    
         location / {
                proxy_pass       http://app:3000;
                proxy_set_header Host $host;
                proxy_set_header X-Real-IP $remote_addr;
                proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
                proxy_set_header X-Forwarded-Proto $scheme;
         }
     }
}
```

**‡∏™‡πà‡∏ß‡∏ô `events`:**

*   **`worker_connections 4000;`**:  ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏à‡∏≥‡∏ô‡∏ß‡∏ô connections ‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î‡∏ó‡∏µ‡πà worker process ‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏ï‡∏±‡∏ß‡∏Ç‡∏≠‡∏á Nginx ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÑ‡∏î‡πâ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Å‡∏±‡∏ô  ‡∏Ñ‡πà‡∏≤‡∏ô‡∏µ‡πâ‡∏Ñ‡∏ß‡∏£‡∏õ‡∏£‡∏±‡∏ö‡πÉ‡∏´‡πâ‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°‡∏Å‡∏±‡∏ö‡∏õ‡∏£‡∏¥‡∏°‡∏≤‡∏ì traffic ‡πÅ‡∏•‡∏∞ resources ‡∏Ç‡∏≠‡∏á server  4000 ‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏î‡∏µ, ‡πÅ‡∏ï‡πà‡∏≠‡∏≤‡∏à‡∏à‡∏∞‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡∏∂‡πâ‡∏ô‡∏ñ‡πâ‡∏≤ server ‡∏°‡∏µ traffic ‡∏™‡∏π‡∏á‡∏°‡∏≤‡∏Å  *‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏£‡∏£‡∏∞‡∏ß‡∏±‡∏á:*  ‡πÅ‡∏ï‡πà‡∏•‡∏∞ connection ‡∏à‡∏∞‡πÉ‡∏ä‡πâ file descriptor  ‡∏ï‡πâ‡∏≠‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏£‡∏∞‡∏ö‡∏ö‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏°‡∏µ limits (‡πÄ‡∏ä‡πà‡∏ô `ulimit -n`) ‡∏ó‡∏µ‡πà‡∏™‡∏π‡∏á‡∏û‡∏≠
*   **`use epoll;`**:  ‡∏ö‡∏≠‡∏Å‡πÉ‡∏´‡πâ Nginx ‡πÉ‡∏ä‡πâ `epoll` (‡∏ö‡∏ô Linux) ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ I/O  `epoll` ‡πÄ‡∏õ‡πá‡∏ô‡∏Å‡∏•‡πÑ‡∏Å‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡∏†‡∏≤‡∏û‡∏™‡∏π‡∏á‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ network connections ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏°‡∏≤‡∏Å  (‡∏ö‡∏ô‡∏£‡∏∞‡∏ö‡∏ö‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏≠‡∏∑‡πà‡∏ô, Nginx ‡∏≠‡∏≤‡∏à‡∏à‡∏∞‡πÉ‡∏ä‡πâ‡∏Å‡∏•‡πÑ‡∏Å‡∏≠‡∏∑‡πà‡∏ô ‡πÄ‡∏ä‡πà‡∏ô `kqueue` ‡∏ö‡∏ô FreeBSD)
*   **`multi_accept on;`**:  ‡∏ö‡∏≠‡∏Å‡πÉ‡∏´‡πâ worker process ‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏ï‡∏±‡∏ß‡∏£‡∏±‡∏ö multiple new connections ‡πÑ‡∏î‡πâ‡πÉ‡∏ô‡∏Ñ‡∏£‡∏≤‡∏ß‡πÄ‡∏î‡∏µ‡∏¢‡∏ß  ‡∏ä‡πà‡∏ß‡∏¢‡∏•‡∏î latency ‡πÅ‡∏•‡∏∞‡πÄ‡∏û‡∏¥‡πà‡∏° throughput

**‡∏™‡πà‡∏ß‡∏ô `http`:**

*   **`include mime.types;`**:  ‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå `mime.types` ‡∏ã‡∏∂‡πà‡∏á‡πÄ‡∏õ‡πá‡∏ô‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏µ‡πà mapping file extensions (‡πÄ‡∏ä‡πà‡∏ô `.html`, `.css`, `.js`) ‡πÄ‡∏Ç‡πâ‡∏≤‡∏Å‡∏±‡∏ö MIME types (‡πÄ‡∏ä‡πà‡∏ô `text/html`, `text/css`, `application/javascript`).  Nginx ‡πÉ‡∏ä‡πâ MIME types ‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏Å‡∏≥‡∏´‡∏ô‡∏î `Content-Type` header ‡πÉ‡∏ô HTTP response, ‡∏ó‡∏≥‡πÉ‡∏´‡πâ browser ‡∏£‡∏π‡πâ‡∏ß‡πà‡∏≤‡∏à‡∏∞‡∏ï‡πâ‡∏≠‡∏á‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Å‡∏±‡∏ö response ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÑ‡∏£
*   **`sendfile on;`**:  ‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô `sendfile()` system call  `sendfile()` ‡∏ä‡πà‡∏ß‡∏¢‡πÉ‡∏´‡πâ Nginx ‡∏™‡πà‡∏á‡πÑ‡∏ü‡∏•‡πå (‡πÇ‡∏î‡∏¢‡πÄ‡∏â‡∏û‡∏≤‡∏∞ static files) ‡πÑ‡∏î‡πâ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡∏†‡∏≤‡∏û‡∏™‡∏π‡∏á ‡πÇ‡∏î‡∏¢‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á copy data ‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á user space ‡∏Å‡∏±‡∏ö kernel space
*   **`tcp_nopush on;`**:  (‡∏ö‡∏ô FreeBSD, ‡∏´‡∏£‡∏∑‡∏≠ `tcp_cork` ‡∏ö‡∏ô Linux)  ‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô optimization ‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Ç‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ö TCP  ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô, Nginx ‡∏à‡∏∞‡∏û‡∏¢‡∏≤‡∏¢‡∏≤‡∏°‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏õ‡πá‡∏ô "chunks" ‡∏ó‡∏µ‡πà‡πÉ‡∏´‡∏ç‡πà‡∏Ç‡∏∂‡πâ‡∏ô, ‡∏•‡∏î overhead ‡∏Ç‡∏≠‡∏á TCP headers  (‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡πÇ‡∏¢‡∏ä‡∏ô‡πå‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÉ‡∏ä‡πâ `sendfile on`)
*   **`keepalive_timeout 65;`**:  ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤ (‡πÄ‡∏õ‡πá‡∏ô‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ) ‡∏ó‡∏µ‡πà Nginx ‡∏à‡∏∞ keep HTTP connection ‡πÑ‡∏ß‡πâ‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏°‡∏µ activity  ‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ keep-alive connections ‡∏ä‡πà‡∏ß‡∏¢‡∏•‡∏î overhead ‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á connection ‡πÉ‡∏´‡∏°‡πà‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏ï‡πà‡∏•‡∏∞ request  65 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏î‡∏µ
*   **`gzip on;`**:  ‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô Gzip compression  Nginx ‡∏à‡∏∞ compress HTTP responses (‡πÄ‡∏ä‡πà‡∏ô HTML, CSS, JavaScript) ‡∏Å‡πà‡∏≠‡∏ô‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏™‡πà‡∏á‡πÑ‡∏õ‡∏¢‡∏±‡∏á client, ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏Ç‡∏ô‡∏≤‡∏î‡∏Ç‡∏≠‡∏á responses ‡πÄ‡∏•‡πá‡∏Å‡∏•‡∏á, ‡πÅ‡∏•‡∏∞‡∏•‡∏î‡πÄ‡∏ß‡∏•‡∏≤‡πÉ‡∏ô‡∏Å‡∏≤‡∏£ download
*   **`gzip_comp_level 6;`**:  ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Ç‡∏≠‡∏á‡∏Å‡∏≤‡∏£ compression  ‡∏Ñ‡πà‡∏≤‡∏≠‡∏¢‡∏π‡πà‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á 1 (‡πÄ‡∏£‡πá‡∏ß‡∏™‡∏∏‡∏î, compression ‡∏ô‡πâ‡∏≠‡∏¢‡∏™‡∏∏‡∏î) ‡∏ñ‡∏∂‡∏á 9 (‡∏ä‡πâ‡∏≤‡∏™‡∏∏‡∏î, compression ‡∏°‡∏≤‡∏Å‡∏™‡∏∏‡∏î)  6 ‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡πà‡∏≤‡∏ó‡∏µ‡πà‡∏™‡∏°‡∏î‡∏∏‡∏•‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á compression ratio ‡∏Å‡∏±‡∏ö CPU usage

**‡∏™‡πà‡∏ß‡∏ô `server`:**

*   **`listen 80;`**:  ‡∏ö‡∏≠‡∏Å‡πÉ‡∏´‡πâ Nginx listen ‡∏ó‡∏µ‡πà port 80 (HTTP).
*   **`server_name _;`**:  `_` ‡πÄ‡∏õ‡πá‡∏ô wildcard ‡∏ó‡∏µ‡πà‡∏´‡∏°‡∏≤‡∏¢‡∏ñ‡∏∂‡∏á "match any hostname"  ‡πÄ‡∏õ‡πá‡∏ô‡∏Å‡∏≤‡∏£ config ‡∏ó‡∏µ‡πà‡∏ö‡∏≠‡∏Å‡∏ß‡πà‡∏≤ server block ‡∏ô‡∏µ‡πâ‡∏à‡∏∞ handle requests ‡∏ó‡∏µ‡πà *‡πÑ‡∏°‡πà* match ‡∏Å‡∏±‡∏ö server block ‡∏≠‡∏∑‡πà‡∏ô ‡πÜ (‡∏ó‡∏µ‡πà‡∏°‡∏µ `server_name` ‡∏ó‡∏µ‡πà‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÄ‡∏à‡∏≤‡∏∞‡∏à‡∏á‡∏Å‡∏ß‡πà‡∏≤)  ‡πÉ‡∏ô‡∏Å‡∏£‡∏ì‡∏µ‡∏ô‡∏µ‡πâ, ‡πÄ‡∏ô‡∏∑‡πà‡∏≠‡∏á‡∏à‡∏≤‡∏Å‡∏°‡∏µ server block ‡πÄ‡∏î‡∏µ‡∏¢‡∏ß, ‡∏°‡∏±‡∏ô‡∏à‡∏∞ handle requests ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
*   **`location / { ... }`**:  ‡∏Å‡∏≥‡∏´‡∏ô‡∏î configuration ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö requests ‡∏ó‡∏µ‡πà match ‡∏Å‡∏±‡∏ö root path (`/`)  (‡∏Ñ‡∏∑‡∏≠‡∏ó‡∏∏‡∏Å requests).
    *   **`proxy_pass http://app:3000;`**:  ‡∏ó‡∏≥ Reverse Proxy:  ‡∏™‡πà‡∏á‡∏ï‡πà‡∏≠ requests ‡πÑ‡∏õ‡∏¢‡∏±‡∏á `http://app:3000` `app` ‡∏Ñ‡∏∑‡∏≠‡∏ä‡∏∑‡πà‡∏≠ service ‡∏Ç‡∏≠‡∏á application ‡πÉ‡∏ô `docker-compose.yml`, ‡πÅ‡∏•‡∏∞ `3000` ‡∏Ñ‡∏∑‡∏≠ port ‡∏ó‡∏µ‡πà application ‡∏£‡∏±‡∏ô‡∏≠‡∏¢‡∏π‡πà
    *   **`proxy_set_header ...`**:  ‡∏Å‡∏≥‡∏´‡∏ô‡∏î HTTP headers ‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏™‡πà‡∏á‡∏ï‡πà‡∏≠‡πÑ‡∏õ‡∏¢‡∏±‡∏á application node.js ‡∏™‡πà‡∏ß‡∏ô Headers ‡πÄ‡∏´‡∏•‡πà‡∏≤‡∏ô‡∏µ‡πâ‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ application server ‡∏£‡∏π‡πâ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö request ‡∏î‡∏±‡πâ‡∏á‡πÄ‡∏î‡∏¥‡∏°:
        *   **`Host $host;`**:  ‡∏™‡πà‡∏á `Host` header ‡πÄ‡∏î‡∏¥‡∏° (‡∏ó‡∏µ‡πà client ‡∏™‡πà‡∏á‡∏°‡∏≤) ‡πÑ‡∏õ‡∏¢‡∏±‡∏á application server
        *   **`X-Real-IP $remote_addr;`**:  ‡∏™‡πà‡∏á IP address ‡∏Ç‡∏≠‡∏á client ‡πÑ‡∏õ‡∏¢‡∏±‡∏á application server
        *   **`X-Forwarded-For $proxy_add_x_forwarded_for;`**:  ‡∏™‡πà‡∏á IP addresses ‡∏ó‡∏µ‡πà request ‡∏ú‡πà‡∏≤‡∏ô‡∏°‡∏≤ (‡∏£‡∏ß‡∏°‡∏ñ‡∏∂‡∏á IP address ‡∏Ç‡∏≠‡∏á proxy servers) ‡πÑ‡∏õ‡∏¢‡∏±‡∏á application server
        *   **`X-Forwarded-Proto $scheme;`**:  ‡∏™‡πà‡∏á protocol (http ‡∏´‡∏£‡∏∑‡∏≠ https) ‡∏ó‡∏µ‡πà client ‡πÉ‡∏ä‡πâ ‡πÑ‡∏õ‡∏¢‡∏±‡∏á application server


### 3.5.4 ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô

‡πÉ‡∏ä‡πâ‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ô‡∏µ‡πâ ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏Ç‡∏≠‡∏á Container
```
docker compose up -d
```

‡∏ñ‡πâ‡∏≤‡∏ó‡∏∏‡∏Å‡∏≠‡∏¢‡∏≤‡∏Å‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á ‡∏à‡∏∞‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏Ç‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö‡πÑ‡∏î‡πâ‡∏à‡∏≤‡∏Å [http://localhost](http://localhost) ‡∏´‡∏£‡∏∑‡∏≠ IP Address ‡∏Ç‡∏≠‡∏á‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á‡πÑ‡∏î‡πâ‡πÇ‡∏î‡∏¢‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏™‡πà Port</br></br>
![](./image/check2-web1.PNG)

‡πÇ‡∏î‡∏¢‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏î‡∏π‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ‡∏à‡∏≤‡∏Å Docker Desktop ‡∏´‡∏£‡∏∑‡∏≠ Command Line Interface</br></br>
**Docker Desktop**</br></br>
![alt text](./image/docker-desktop-finish-0.PNG)</br></br>
![alt text](./image/docker-desktop-finish.PNG)</br></br>
**Docker Command Line**</br>
(‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡πÉ‡∏™‡πà `-d` ‡∏ï‡∏≠‡∏ô `docker compose up` ‡∏´‡∏£‡∏∑‡∏≠‡πÉ‡∏ä‡πâ‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á `docker logs -f [container name/id]`)</br></br>
![alt text](./image/docker-cli-finish.PNG)
